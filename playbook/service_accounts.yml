---
- name: Create Namespace and Service Accounts for 3-tier app in Minikube
  hosts: n1
  gather_facts: false
  vars:
    namespace: LMS
    service_accounts:
      - db-sa
      - app-sa
      - web-sa

  tasks:
    - name: Ensure namespace "{{ namespace }}" exists
      community.kubernetes.k8s:
        state: present
        definition:
          apiVersion: v1
          kind: Namespace
          metadata:
            name: "{{ namespace }}"

    - name: Create service accounts in "{{ namespace }}"
      community.kubernetes.k8s:
        state: present
        definition:
          apiVersion: v1
          kind: ServiceAccount
          metadata:
            name: "{{ item }}"
            namespace: "{{ namespace }}"
      loop: "{{ service_accounts }}"
